#!/bin/bash
# Use !/usr/bin/env bash

BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
FILES_LIST="bashrc screenrc gitconfig vim tmux.conf"
NOW=$(date +"%Y%m%d")
BACKUP="no"
INSTALL="no"
SYMLINK="no"

# HELP Message.
usage() {
	cat 1>&2 <<EOF
Usage: $0 [-b] [-i] [-h]
	-b Backup old file
	-i Install dotfiles [Rewrite existing files]
	-s Symlinking dotfiles [Rewrite existing files]
	-h Print HELP message
EOF
	exit 1
}

# Without any parameter print HELP message.
if [ $# -eq 0 ];
then
	usage;
fi

# Paprsing script parameters.
while getopts 'bih' opt; do
	case "${opt}" in
		b) BACKUP=yes ;;
		i) INSTALL=yes ;;
		s) SYMLINK=yes ;;
		h) usage ;;
		*) echo "Unknown option $opt" 1>&2; usage ;;
	esac
done
shift $(( $OPTIND - 1 ))

# Rename any existing dotfilesk.
for FILE in $FILES_LIST; do
	# backuping old files if requested.
	if [ "$BACKUP" == "yes" ];
	then
		echo "Backuping ~/.$FILE to ~/.$FILE-$NOW"
		mv ~/.$FILE ~/.$FILE-$NOW
	fi

	# Symlinking dot file to HOME directory.
	if [ "$SYMLINK" == "yes" ];
	then
		echo "Create symlink to $FILE in home directory"
		rm -rf ~/.$FILE
		ln -s $BASEDIR/$FILE ~/.$FILE
	# Copy dot file in to the HOME directory.
	elif [ "$INSTALL" == "yes" ];
	then
		echo "Copy $FILE in to the HOME directory"
		rm -rf ~/.$FILE
		cp $BASEDIR/$FILE ~/.$FILE
	fi
done

# Installing git submodules
echo "Installing git submodules"
git submodule update --init --recursive

# Installing vim plugins
echo "Installing vim plugins."
vim +PluginInstall +qall
